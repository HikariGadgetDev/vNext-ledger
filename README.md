# vNext Ledger — 設計判断を失わないための軽量台帳

vNext Ledger は、**コード中に埋もれ、消えていく設計判断を確実に記録することを目的として作成**されました。  
Jira や Notion の代替ではありません。**リポジトリそのものを一次情報源として扱うための軽量補助ツール**です。

---

## これは何か（What）

- `NOTE(vNext)` / `DONE(vNext)` などの **vNext 系コメント**をコードから自動収集
- 出現箇所（ファイル / 行番号）を **SQLite 単一ファイル**に永続化
- 差分スキャンと全走査（収束操作）を分離し、**事故らない運用**を保証
- CLI / HTTP API 両対応、CI 連携可能

---

## これは何ではないか（What it is NOT）

- タスク管理ツールではありません  
- チケット駆動開発を置き換えません  
- 人を管理・リマインドする仕組みではありません  

**目的はただ一つ**  
> 「今じゃない判断」を、未来まで確実に残すこと

---

## 背景にある問題意識

- TODO コメントは必ず死ぬ
- 設計案は Slack / PR / 脳内で蒸発する
- 半年後に「なぜこうしたか」が誰にも分からない
- 結果、技術的負債は人の記憶に依存する

vNext Ledger はこれを **構造で解決**します。

---

## 基本思想

### 1. 観測と収束を分離する

- **差分 scan（安全）**  
  - 変更されたファイルのみを観測
  - stale / orphan には触らない
- **full scan（収束）**  
  - 全走査 + 世界を閉じる操作
  - stale / orphan の整理はこのときのみ

👉 収束は「意図した操作」でしか起きません。

---

### 2. vNext は「立法府」である

- 思いつきは捨てない
- しかし今は実装しない
- **vNext に隔離して文明として保存する**

---

### 3. 人を責めない。文明を修復する。

- リマインドしない
- 運用ルールを強制しない
- **書いた瞬間に台帳へ入る構造**を作る

---

## 仕組み概要

### コメント規約（例）

```python
# NOTE(vNext): login-flow-stealth-injection
# DONE(vNext): video-flow-entrypoint
```

- slug は小文字・英数・`-` / `_` 推奨
- slug が **台帳の主キー**になります

---

### 永続化される情報

- slug
- 種別（NOTE / DONE）
- ファイルパス
- 行番号
- 最終観測時刻
- 状態（active / stale）

すべて **SQLite 単一ファイル**に保存されます。

---

## API / CLI 概要

### 起動

```bash
python -m uvicorn app:app
```

起動時に必ず以下を表示します：

- DB のパス
- 解決された scan root

👉 環境変数 / cwd 事故の即時切り分け用です。

---

### スキャン（差分・安全）

```bash
curl -X POST http://127.0.0.1:8000/scan
```

---

### スキャン（全走査・収束）

```bash
curl -X POST "http://127.0.0.1:8000/scan?full=true"
```

⚠️ **これは世界を閉じる操作です。CI や定期実行では使用しないでください。**

---

### 台帳取得

```bash
curl http://127.0.0.1:8000/notes
curl http://127.0.0.1:8000/notes/{slug}
```

---

### JSON ログ / メトリクス

```bash
curl http://127.0.0.1:8000/export/scan_history
curl http://127.0.0.1:8000/export/metrics
```

- diff が効いているか
- full scan をいつ実行したか
- evidence が増えているか

すべて観測可能です。

---

## どんな人向けか

- 一人または少人数で大規模コードを守っている人
- 設計判断を「忘却」ではなく「保存」したい人
- TODO 管理に絶望したことがある人
- Jira と設計思想を混ぜて地獄を見た人

---

## 逆に向かない人

- チケット駆動で全てを管理したい
- 設計判断をドキュメントで完結させたい
- 人にリマインドされたい

---

## ライセンス / 公開について

このリポジトリは **設計思想そのものが価値**です。  
公開・非公開の判断は以下で決めてください：

- **営業資産にする → 非公開 / 限定公開**
- **思想を投げる → 公開（OSS）**

どちらでも成立する設計です。

---

## 最後に

vNext Ledger は派手なツールではありません。  
しかしこれは、

> **「忘れないための構造」**

を持った、極めて実務的な道具です。

人が枯れても、  
記憶が消えても、  
**文明だけは残る。**

---

以上。
