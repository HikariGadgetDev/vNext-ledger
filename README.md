# vNext Ledger — 設計判断を失わないための軽量台帳

vNext Ledger は、**コード中に埋もれ、消えていく設計判断を確実に記録することを目的として作成**されました。  
Jira や Notion の代替ではありません。**リポジトリそのものを一次情報源として扱うための軽量補助ツール**です。

---

## これは何か（What）

- `NOTE(vNext)` / `DONE(vNext)` などの **vNext 系コメント**をコードから自動収集  
- 出現箇所（ファイル / 行番号）を **SQLite 単一ファイル**に永続化  
- 差分スキャンと全走査（収束操作）を分離し、**事故らない運用**を保証  
- CLI / HTTP API 両対応、CI 連携可能  

---

## これは何ではないか（What it is NOT）

- タスク管理ツールではありません  
- チケット駆動開発を置き換えません  
- 人を管理・リマインドする仕組みではありません  

**目的はただ一つ**  

> 「今じゃない判断」を、未来まで確実に残すこと

---

## 🔧 チケット管理との違い

| | チケット管理 | vNext Ledger |
|---|---|---|
| 管理対象 | タスク | 設計判断 |
| 入力コスト | 明示的（作業） | コメントを書く |
| 認知負荷 | 高い | 低い |
| 向いている場面 | 実装進行 | 「今やらない」判断の保存 |

vNext Ledger は **チケットの代替ではありません**。  
チケット化するには**重すぎる**、実装に着手するには**早すぎる**、
しかし**捨てるには惜しい判断**を、忘却せず保留として保存するための道具です。

---

## 背景にある問題意識

- TODO コメントは必ず死ぬ  
- 設計案は Slack / PR / 脳内で蒸発する  
- 半年後に「なぜこうしたか」が誰にも分からない  
- 結果、技術的負債は人の記憶に依存する  

vNext Ledger はこれを **構造で解決**します。

---

## 🔧 具体例：TODO コメントはどう死ぬか

### Before（よくある状況）

```python
# TODO: cfg周り、将来拡張考えると設計変えた方がいいかも
def load_config():
    ...
```

- どこにあるか分からなくなる  
- いつ書いたか分からない  
- なぜ今やらなかったか分からない  
- 他の TODO との関係が見えない  

結果、**誰も触らないまま忘却されます**。

---

### After（vNext Ledger を使うと）

```python
# NOTE(vNext): cfg-normalization
def load_config():
    ...
```

- 書いた瞬間に台帳へ記録される  
- 「今やらない」という判断が保存される  
- 後から `cfg` で検索できる  
- full scan を実行した時だけ世界が収束する  

👉 **TODO は記憶に依存するが、vNext は構造に残る。**

---

## 🔧 具体例：止血作業中の「賢い改善」が事故を起こすとき

- 本番で不具合が見つかり、止血対応をしている  
- 修正自体は小さい  
- しかし周辺コードを見て、こう思う  

```python
# NOTE(vNext): cfg-normalization
# （止血が終わった後で検討する）
```

> 「cfg周り、将来拡張を考えると整理した方がよさそう」

この判断自体は **間違っていません**。  
問題は **「今やるべきではない」** という点です。

vNext Ledger は  
**賢さを否定せず、タイミングだけを制御**します。

---

## 基本思想

### 1. 観測と収束を分離する

- **差分 scan（安全）**  
  - 変更されたファイルのみを観測  
  - stale / orphan には触らない  
- **full scan（収束）**  
  - 全走査 + 世界を閉じる操作  
  - stale / orphan の整理はこのときのみ  

👉 収束は「意図した操作」でしか起きません。

---

### 2. vNext は「立法府」である

- 思いつきは捨てない  
- しかし今は実装しない  
- **vNext に隔離して文明として保存する**

---

### 3. 人を責めない。文明を修復する。

- リマインドしない  
- 運用ルールを強制しない  
- **書いた瞬間に台帳へ入る構造**を作る  

---

## 仕組み概要

### コメント規約（唯一の入力）

```python
# NOTE(vNext): login-flow
# DONE(vNext): entrypoint
```

- slug は小文字・英数・`-` / `_` 推奨  
- slug が **台帳の主キー**になります  

---

### 永続化される情報

- slug  
- 種別（NOTE / DONE）  
- ファイルパス  
- 行番号  
- 最終観測時刻  
- 状態（active / stale）  

すべて **SQLite 単一ファイル**に保存されます。

---

## API / CLI 概要

（※既存記述そのまま）

---

## どんな人向けか

- 一人または少人数で大規模コードを守っている人  
- 設計判断を「忘却」ではなく「保存」したい人  
- TODO 管理に絶望したことがある人  
- Jira と設計思想を混ぜて地獄を見た人  

---

## 逆に向かない人

- チケット駆動で全てを管理したい  
- 設計判断をドキュメントで完結させたい  
- 人にリマインドされたい  

---

## 最後に

vNext Ledger は派手なツールではありません。  
しかしこれは、

> **「忘れないための構造」**

を持った、極めて実務的な道具です。

人が枯れても、  
記憶が消えても、  
**文明だけは残る。**
